class PopUpForm{constructor(e,t={},s=null){this.title=e,this.form_schema=t,this.data=null,this.callback=s,this.event=new Array,this.eventListener=new Array,!0===(this.valid=this.validate())?this.init():console.error(this.valid),this.on("ready",(()=>{window.jQuery&&($(this.element).find(".js-example-basic-multiple")&&null!=$().select2&&$(this.element).find(".js-example-basic-multiple").select2(),$(this.element).find(".summernote")&&null!=$.summernote&&$(this.element).find(".summernote").summernote({toolbar:[["style",["bold","italic","underline","clear"]],["font",["strikethrough","superscript","subscript"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]]]}))}))}on(e,t,s={}){let listener=()=>{let e={preventDefault:!1},s={preventDefault:()=>{e.preventDefault=!0}};return t.bind(this)(s),e},i=!0;this.event.forEach((t=>{t==e&&(listener(),i=!1)})),i&&this.eventListener.push({type:e,listener:listener,options:s})}addEvent(e,t=!1){t&&this.event.push(e);let s={preventDefault:!1};return this.eventListener.forEach((t=>{t.type==e&&(s=t.listener())})),s}validate(){if(!Array.isArray(this.form_schema))return"Second Parameter has to be a array. "+typeof this.form_schema+" given.";for(let e=0;e<this.form_schema.length;e++){if("object"==typeof this.form_schema[e])if(this.form_schema[e].hasOwnProperty("type")&&"string"==typeof this.form_schema[e].type){if((void 0===this.form_schema[e].name||this.form_schema[e].hasOwnProperty("name")&&"string"==typeof this.form_schema[e].name)&&(void 0===this.form_schema[e].value||this.form_schema[e].hasOwnProperty("value")&&["string","number"].indexOf(typeof this.form_schema[e].value)>-1||"select"==this.form_schema[e].type&&Array.isArray(this.form_schema[e].value))&&this.form_schema[e].hasOwnProperty("label")&&"string"==typeof this.form_schema[e].label)continue}else if(this.form_schema[e].hasOwnProperty("title")&&"string"==typeof this.form_schema[e].title)continue;return"Validation schlug fehl."}return!0}hide(e=!0){if(e&&null!=this.data){let e=0;for(let t=0;t<this.form_element.length;t++)if(0==this.form_element[t].classList.contains("discard")){let s=this.form_element[t].childNodes[1];"checkbox"==this.form_schema[t].type&&(s.checked=1==this.data[t-e].value),"textarea"==this.form_schema[t].type?s.innerText=null!=this.data?this.data[t-e].value:this.form_schema[t].value:s.value=null!=this.data?this.data[t-e].value:this.form_schema[t].value}else e++}this.element.classList.add("hidden")}confirm(){this.data=new Array;for(let e=0;e<this.form_element.length;e++)if(0==this.form_element[e].classList.contains("discard")){let t,s;"select"==this.form_schema[e].type?(t=this.form_element[e].querySelector("select"),this.form_element[e].querySelector("select").hasAttribute("multiple")?(s=[],this.form_element[e].querySelectorAll("select option").forEach((e=>{e.selected&&s.push(e.getAttribute("value"))}))):s=t.value):"textarea"==this.form_schema[e].type?(t=this.form_element[e].querySelector("textarea"),s=t.value):(t=this.form_element[e].querySelector("input"),s="checkbox"==t.getAttribute("type")?t.checked?t.value:0:t.value),this.data.push({name:t.getAttribute("name"),value:s})}if(1==this.addEvent("confirm").preventDefault)return this.data=null,!1;this.callback(null,this.data),this.hide(!1),this.addEvent("confirmed")}init(){this.form_element=new Array;for(let e=0;e<this.form_schema.length;e++){let t;if(this.form_schema[e].hasOwnProperty("title")){if(t=document.createElement("h4"),t.innerText=this.form_schema[e].title,this.form_schema[e].hasOwnProperty("attributes")&&Object.keys(this.form_schema[e].attributes).length>0)for(let s in this.form_schema[e].attributes)t.setAttribute(s,this.form_schema[e].attributes[s]);this.form_element.push(t),t.classList.add("discard");continue}switch(this.form_schema[e].type){case"select":t=document.createElement("select"),t.innerHTML=this.form_schema[e].hasOwnProperty("default_value")?'<option value="'+this.form_schema[e].default_value+'">Auswählen</option>':'<option disabled="disabled" selected="selected" value="">Auswählen</option>';for(let s=0;s<this.form_schema[e].value.length;s++){if("object"!=typeof this.form_schema[e].value[s])return void this.callback("Typ select has no valid object values.",null);this.form_schema[e].hasOwnProperty("selected")?t.innerHTML+='<option value="'+this.form_schema[e].value[s].value+'"'+(this.form_schema[e].selected==this.form_schema[e].value[s].value?' selected="selected"':"")+">"+this.form_schema[e].value[s].name+"</option>":t.innerHTML+='<option value="'+this.form_schema[e].value[s].value+'">'+this.form_schema[e].value[s].name+"</option>"}break;case"text":case"password":case"hidden":case"number":case"checkbox":t=document.createElement("input"),t.setAttribute("type",this.form_schema[e].type),this.form_schema[e].hasOwnProperty("value")&&t.setAttribute("value",this.form_schema[e].value);break;case"textarea":t=document.createElement("textarea"),t.classList.add("card"),t.style.width="-webkit-fill-available",this.form_schema[e].hasOwnProperty("value")&&(t.innerText=this.form_schema[e].value);break;default:return void this.callback("Type: "+this.form_schema[e].type+" is not supported.",null)}let s=document.createElement("div"),i=document.createElement("label"),a="popUpForm_"+PopUpForm.input_counter+++(this.form_schema[e].name||"");if(s.classList.add("input",this.form_schema[e].type),void 0===this.form_schema[e].name?s.classList.add("discard"):t.setAttribute("name",this.form_schema[e].name),i.setAttribute("for",a),i.innerText="string"==typeof this.form_schema[e].label?this.form_schema[e].label:this.form_schema[e].name,t.setAttribute("id",a),this.form_schema[e].hasOwnProperty("attributes")&&Object.keys(this.form_schema[e].attributes).length>0)for(let s in this.form_schema[e].attributes)t.setAttribute(s,this.form_schema[e].attributes[s]);if(this.form_schema[e].hasOwnProperty("eventListener")&&Object.keys(this.form_schema[e].eventListener).length>0)for(let s in this.form_schema[e].eventListener)t.addEventListener(s,this.form_schema[e].eventListener[s]);s.appendChild(i),s.appendChild(t),this.form_element.push(s)}this.element=document.createElement("li"),this.popUp_header_title_h2=document.createElement("h2");let e=document.getElementById("popup_container"),t=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),h=document.createElement("button"),n=document.createElement("button");t.classList.add("popup"),s.classList.add("popup_header"),this.popUp_header_title_h2.innerText=this.title,i.classList.add("popup_body"),a.classList.add("popup_content");for(let e=0;e<this.form_element.length;e++)a.appendChild(this.form_element[e]);r.classList.add("popup_dialog"),h.classList.add("confirm"),h.innerText="Bestätigen",h.addEventListener("click",(()=>{this.confirm()})),n.classList.add("cancel"),n.innerText="Abbrechen",n.addEventListener("click",(()=>{this.hide()})),i.appendChild(a),r.appendChild(h),r.appendChild(n),i.appendChild(r),s.appendChild(this.popUp_header_title_h2),t.appendChild(s),t.appendChild(i),this.element.appendChild(t),this.addEvent("beforeReady",!0),e.appendChild(this.element),this.addEvent("ready",!0)}show(){this.element.classList.remove("hidden")}set setTitle(e){this.title=e.toString(),this.popUp_header_title_h2.innerText=this.title}}PopUpForm.input_counter=0;